{% extends 'base.html' %} {% block content %}
<h1>Usuários</h1>
{% if session.get('user_tipo') == 'Administrador' %}
<p><a href="{{ url_for('main.admin_novo_usuario') }}">Novo Usuário</a></p>
{% endif %}
<table>
  <tr>
    <th>Nome</th>
    <th>Tipo</th>
    <th>Email</th>
  </tr>
  {% for u in usuarios %}
  <tr>
    <td>{{ u.nome }}</td>
    <td>{{ u.tipo }}</td>
    <td>{{ u.email }}</td>
    {% if session.get('user_tipo') == 'Administrador' %}
    <td>
      <button class="btn danger" type="button" onclick="confirmDeleteUser({{ u.id }}, '{{ u.nome }}')">Remover</button>
    </td>
    {% endif %}
  </tr>
  {% endfor %}
</table>

<!-- Modal de Confirmação de Exclusão de Usuário -->
<div id="modal-delete-user" class="modal-overlay">
  <div class="modal-box">
    <div class="modal-title">Excluir Usuário</div>
    <div class="modal-body" id="modal-delete-user-body"></div>
    <div class="modal-actions">
      <button class="btn ghost" onclick="closeModalUser()">Cancelar</button>
      <button class="btn danger" id="modal-delete-user-btn">Confirmar Exclusão</button>
    </div>
  </div>
</div>

<script>
function closeModalUser() {
  document.getElementById('modal-delete-user').classList.remove('show');
}

function confirmDeleteUser(userId, userName) {
  const modal = document.getElementById('modal-delete-user');
  document.getElementById('modal-delete-user-body').innerHTML = `Tem certeza que deseja excluir o usuário:<br/><strong>"${userName}"</strong><br/><br/>Esta ação não pode ser desfeita!`;
  modal.classList.add('show');
  
  document.getElementById('modal-delete-user-btn').onclick = function() {
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = `/admin/usuarios/${userId}/delete`;
    document.body.appendChild(form);
    form.submit();
  };
}
</script>
{% endblock %}
